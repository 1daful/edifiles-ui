import{Client as e,createRequest as u}from"@urql/core";export*from"@urql/core";import{isRef as a,ref as r,getCurrentInstance as t,provide as s,inject as v,reactive as l,shallowRef as n,watchEffect as i,onBeforeUnmount as o,onMounted as c}from"vue";import{subscribe as p,onEnd as f,toPromise as q,take as d,filter as x,onPush as b}from"wonka";var h=new WeakMap;function y(u){var v;v=a(u)?u:r(u instanceof e?u:new e(u));var l=t();return l&&h.set(l,v),s("$urql",v),v.value}function P(u,t){var s;s=a(t)?t:r(t instanceof e?t:new e(t)),u.provide("$urql",s)}function m(){var e=t(),u=v("$urql");return!u&&e&&(u=h.get(e)),u}function g(e){return e&&a(e)?e.value:e}var w=(e,u)=>{for(var a in u)if(e.value[a]!==u[a])return void(e.value=u)},M={flush:"pre"};function Q(e){return S(e)}function S(e,t=m(),s=[]){var v=l(e),o=r(),c=r(!1),q=r(!1),d=r(),x=r(),b=r(),h=a(e.pause)?e.pause:r(!!e.pause),y=n({request:u(g(v.query),g(v.variables)),requestPolicy:g(v.requestPolicy),isPaused:h.value}),P=r();s.push(i((()=>{w(y,{request:u(g(v.query),g(v.variables)),requestPolicy:g(v.requestPolicy),isPaused:h.value})}),M)),s.push(i((()=>{P.value=y.value.isPaused?void 0:t.value.executeQuery(y.value.request,{requestPolicy:g(v.requestPolicy),...g(v.context)})}),M));var Q={data:o,stale:c,error:d,operation:x,extensions:b,fetching:q,isPaused:h,executeQuery(e){var u=P.value=t.value.executeQuery(y.value.request,{requestPolicy:g(v.requestPolicy),...v.context,...e});return{...S,then(e,a){var r;return new Promise((e=>{var a=!1;r=p((()=>{Q.fetching.value||Q.stale.value||(r&&r.unsubscribe(),a=!0,e(Q))}))(u),a&&r.unsubscribe()})).then(e,a)}}},pause(){h.value=!0},resume(){h.value=!1}};s.push(i((e=>{P.value?(q.value=!0,c.value=!1,e(p((e=>{o.value=e.data,c.value=!!e.stale,q.value=!1,d.value=e.error,x.value=e.operation,b.value=e.extensions}))(f((()=>{q.value=!1,c.value=!1}))(P.value)).unsubscribe)):(q.value=!1,c.value=!1)}),{flush:"sync"}));var S={...Q,then(e,u){var a;return new Promise((e=>{if(!P.value)return e(Q);var u=!1;a=p((()=>{Q.fetching.value||Q.stale.value||(a&&a.unsubscribe(),u=!0,e(Q))}))(P.value),u&&a.unsubscribe()})).then(e,u)}};return S}function $(e){return k(e)}function k(e,a=m()){var t=r(),s=r(!1),v=r(!1),l=r(),n=r(),i=r();return{data:t,stale:s,fetching:v,error:l,operation:n,extensions:i,executeMutation:(r,o)=>(v.value=!0,q(d(1)(x((e=>!e.hasNext))(b((e=>{t.value=e.data,s.value=e.stale,v.value=!1,l.value=e.error,n.value=e.operation,i.value=e.extensions}))(a.value.executeMutation(u(e,g(r)),o||{}))))))}}var N={flush:"pre"};function W(e,u){return j(e,u)}function j(e,t,s=m(),v=[]){var o=l(e),c=r(),q=r(!1),d=r(!1),x=r(),b=r(),h=r(),y=r(t),P=a(e.pause)?e.pause:r(!!e.pause),M=n({request:u(g(o.query),g(o.variables)),isPaused:P.value}),Q=r();v.push(i((()=>{w(M,{request:u(g(o.query),g(o.variables)),isPaused:P.value})}),N)),v.push(i((()=>{Q.value=P.value?void 0:s.value.executeSubscription(M.value.request,{...g(o.context)})}),N)),v.push(i((e=>{Q.value?(d.value=!0,e(p((e=>{d.value=!0,c.value=void 0!==e.data&&"function"==typeof y.value?y.value(c.value,e.data):e.data,x.value=e.error,h.value=e.extensions,q.value=!!e.stale,b.value=e.operation}))(f((()=>{d.value=!1}))(Q.value)).unsubscribe)):d.value=!1}),N));var S={data:c,stale:q,error:x,operation:b,extensions:h,fetching:d,isPaused:P,executeSubscription:e=>(Q.value=s.value.executeSubscription(M.value.request,{...g(o.context),...e}),S),pause(){P.value=!0},resume(){P.value=!1}};return S}function z(){var e=m(),u=[];return o((()=>{for(var e;e=u.shift();)e()})),{client:e.value,useQuery:a=>S(a,e,u),useSubscription:(a,r)=>j(a,r,e,u),useMutation:u=>k(u,e)}}export{P as default,P as install,y as provideClient,z as useClientHandle,$ as useMutation,Q as useQuery,W as useSubscription};
//# sourceMappingURL=urql-vue.min.mjs.map
