Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),u=require("vue"),r=require("wonka"),t=new WeakMap;function a(r,t){var a;a=u.isRef(t)?t:u.ref(t instanceof e.Client?t:new e.Client(t)),r.provide("$urql",a)}function s(){var e=u.getCurrentInstance(),r=u.inject("$urql");return!r&&e&&(r=t.get(e)),r}function n(e){return e&&u.isRef(e)?e.value:e}var l=(e,u)=>{for(var r in u)if(e.value[r]!==u[r])return void(e.value=u)},i={flush:"pre"};function v(t,a=s(),v=[]){var o=u.reactive(t),c=u.ref(),f=u.ref(!1),p=u.ref(!1),b=u.ref(),q=u.ref(),h=u.ref(),d=u.isRef(t.pause)?t.pause:u.ref(!!t.pause),x=u.shallowRef({request:e.createRequest(n(o.query),n(o.variables)),requestPolicy:n(o.requestPolicy),isPaused:d.value}),y=u.ref();v.push(u.watchEffect((()=>{l(x,{request:e.createRequest(n(o.query),n(o.variables)),requestPolicy:n(o.requestPolicy),isPaused:d.value})}),i)),v.push(u.watchEffect((()=>{y.value=x.value.isPaused?void 0:a.value.executeQuery(x.value.request,{requestPolicy:n(o.requestPolicy),...n(o.context)})}),i));var P={data:c,stale:f,error:b,operation:q,extensions:h,fetching:p,isPaused:d,executeQuery(e){var u=y.value=a.value.executeQuery(x.value.request,{requestPolicy:n(o.requestPolicy),...o.context,...e});return{...w,then(e,t){var a;return new Promise((e=>{var t=!1;a=r.subscribe((()=>{P.fetching.value||P.stale.value||(a&&a.unsubscribe(),t=!0,e(P))}))(u),t&&a.unsubscribe()})).then(e,t)}}},pause(){d.value=!0},resume(){d.value=!1}};v.push(u.watchEffect((e=>{y.value?(p.value=!0,f.value=!1,e(r.subscribe((e=>{c.value=e.data,f.value=!!e.stale,p.value=!1,b.value=e.error,q.value=e.operation,h.value=e.extensions}))(r.onEnd((()=>{p.value=!1,f.value=!1}))(y.value)).unsubscribe)):(p.value=!1,f.value=!1)}),{flush:"sync"}));var w={...P,then(e,u){var t;return new Promise((e=>{if(!y.value)return e(P);var u=!1;t=r.subscribe((()=>{P.fetching.value||P.stale.value||(t&&t.unsubscribe(),u=!0,e(P))}))(y.value),u&&t.unsubscribe()})).then(e,u)}};return w}function o(t,a=s()){var l=u.ref(),i=u.ref(!1),v=u.ref(!1),o=u.ref(),c=u.ref(),f=u.ref();return{data:l,stale:i,fetching:v,error:o,operation:c,extensions:f,executeMutation:(u,s)=>(v.value=!0,r.toPromise(r.take(1)(r.filter((e=>!e.hasNext))(r.onPush((e=>{l.value=e.data,i.value=e.stale,v.value=!1,o.value=e.error,c.value=e.operation,f.value=e.extensions}))(a.value.executeMutation(e.createRequest(t,n(u)),s||{}))))))}}var c={flush:"pre"};function f(t,a,i=s(),v=[]){var o=u.reactive(t),f=u.ref(),p=u.ref(!1),b=u.ref(!1),q=u.ref(),h=u.ref(),d=u.ref(),x=u.ref(a),y=u.isRef(t.pause)?t.pause:u.ref(!!t.pause),P=u.shallowRef({request:e.createRequest(n(o.query),n(o.variables)),isPaused:y.value}),w=u.ref();v.push(u.watchEffect((()=>{l(P,{request:e.createRequest(n(o.query),n(o.variables)),isPaused:y.value})}),c)),v.push(u.watchEffect((()=>{w.value=y.value?void 0:i.value.executeSubscription(P.value.request,{...n(o.context)})}),c)),v.push(u.watchEffect((e=>{w.value?(b.value=!0,e(r.subscribe((e=>{b.value=!0,f.value=void 0!==e.data&&"function"==typeof x.value?x.value(f.value,e.data):e.data,q.value=e.error,d.value=e.extensions,p.value=!!e.stale,h.value=e.operation}))(r.onEnd((()=>{b.value=!1}))(w.value)).unsubscribe)):b.value=!1}),c));var R={data:f,stale:p,error:q,operation:h,extensions:d,fetching:b,isPaused:y,executeSubscription:e=>(w.value=i.value.executeSubscription(P.value.request,{...n(o.context),...e}),R),pause(){y.value=!0},resume(){y.value=!1}};return R}exports.default=a,exports.install=a,exports.provideClient=function(r){var a;a=u.isRef(r)?r:u.ref(r instanceof e.Client?r:new e.Client(r));var s=u.getCurrentInstance();return s&&t.set(s,a),u.provide("$urql",a),a.value},exports.useClientHandle=function(){var e=s(),r=[];return u.onBeforeUnmount((()=>{for(var e;e=r.shift();)e()})),{client:e.value,useQuery:u=>v(u,e,r),useSubscription:(u,t)=>f(u,t,e,r),useMutation:u=>o(u,e)}},exports.useMutation=function(e){return o(e)},exports.useQuery=function(e){return v(e)},exports.useSubscription=function(e,u){return f(e,u)},Object.keys(e).forEach((function(u){"default"===u||exports.hasOwnProperty(u)||Object.defineProperty(exports,u,{enumerable:!0,get:function(){return e[u]}})}));
//# sourceMappingURL=urql-vue.min.js.map
